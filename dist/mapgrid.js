!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jsdom")):"function"==typeof define&&define.amd?define(["jsdom"],e):"object"==typeof exports?exports.MapGrid=e(require("jsdom")):t.MapGrid=e(t.jsdom)}(global,(function(t){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";const r=i(1),n=i(2),s=i(6);t.exports=class extends s{constructor(t,e,i,r,{gridColumns:n=5,gridRows:s=5,dpi:a=96,showGrid:o=!0,showText:h=!0}={}){if(super(),this.box=e,this.canvasWidth=i,this.canvasHeight=r,t?this.ctx=t:this._initCtx(),this.gridColumns=n,this.gridRows=s,this.showGrid=o,this.showText=h,this.dpi=a,0!==n||0!==s)this.gridLinePadding={top:0,right:0,bottom:0,left:0},this._initLayer(),this._drawGridText(),this._drawGridLine(),this._render();else{const t=this.box[2]-this.box[0],e=this.box[3]-this.box[1];console.log(`区域纬度跨度${e}，经度跨度${t}，没有格网线！`)}}getCanvas(){return this.canvas}setGridRC(t,e){this.gridColumns=e,this.gridRows=t,this.clearAll(),this._drawGridText(),this._drawGridLine(),this._render()}clearAll(){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight)}release(){this.clearAll(),this.canvas=null,this.gridLineLayer.ctx.clearRect(0,0,this.gridLineLayer.width,this.gridLineLayer.height),this.gridLineLayer.canvas=null,this.gridLineLayer=null,this.gridTextLayer.ctx.clearRect(0,0,this.gridLineLayer.width,this.gridLineLayer.height),this.gridTextLayer.canvas=null,this.gridTextLayer=null}_initCtx(){this.canvas=this.document.createElement("canvas"),this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.ctx=this.canvas.getContext("2d")}_initLayer(){const t=this.document.createElement("canvas");t.width=this.canvasWidth,t.height=this.canvasHeight,this.gridLineLayer={canvas:t,width:this.canvasWidth,height:this.canvasHeight,ctx:t.getContext("2d")};const e=this.document.createElement("canvas");e.width=this.canvasWidth,e.height=this.canvasHeight,this.gridTextLayer={canvas:e,width:this.canvasWidth,height:this.canvasHeight,ctx:e.getContext("2d")}}_render(){this.showText&&this._addGridTextToCanvas(),this.showGrid&&this._addGridLineToCanvas()}removeGridLine(){return r.removeGridLine.call(this)}_addGridLineToCanvas(){return r._addGridLineToCanvas.call(this)}_drawGridLine(){return r.drawGridLine.call(this)}_addGridTextToCanvas(){return n._addGridTextToCanvas.call(this)}_drawGridText(){return n._drawGridText.call(this)}}},function(t,e,i){"use strict";t.exports={removeGridLine(){this.gridLineLayer.ctx.clearRect(0,0,this.gridLineLayer.width,this.gridLineLayer.height),this.showGrid=!1,this.clearAll(),this._render()},_addGridLineToCanvas(){this.ctx.drawImage(this.gridLineLayer.canvas,0,0,this.gridLineLayer.width,this.gridLineLayer.height,0,0,this.canvasWidth,this.canvasHeight)},drawGridLine(){const{top:t,right:e,bottom:i,left:r}=this.gridLinePadding,n=this.gridLineLayer.ctx;n.clearRect(0,0,this.gridLineLayer.width,this.gridLineLayer.height);const s=this.gridColumns,a=this.gridRows;(s>30||a>30)&&console.log("大于30个");const o=Math.ceil(this.canvasWidth/s),h=Math.ceil(this.canvasHeight/a);n.globalAlpha=1,n.strokeStyle="rgba(0, 0, 0, 255)";for(let e=1;e<s;++e)n.beginPath(),n.moveTo(o*e,0+t),n.lineTo(o*e,this.canvasHeight-i),n.stroke();for(let t=1;t<a;++t)n.beginPath(),n.moveTo(0+r,h*t),n.lineTo(this.canvasWidth-e,h*t),n.stroke()}}},function(t,e,i){"use strict";const r=i(3),n=i(4),s=i(5);t.exports={_addGridTextToCanvas(){this.ctx.drawImage(this.gridTextLayer.canvas,0,0,this.gridTextLayer.width,this.gridTextLayer.height,0,0,this.canvasWidth,this.canvasHeight)},_drawGridText(){const t=this.gridTextLayer.ctx;t.clearRect(0,0,this.gridTextLayer.width,this.gridTextLayer.height);const e=this.gridColumns,i=this.gridRows,a=this.box;if((e>30||i>30)&&console.log("大于30个"),0===e&&0===i){const t=a[2]-a[0],e=a[3]-a[1];return void console.log(`区域纬度跨度${e}，经度跨度${t}，没有格网线！`)}const o=[...s.lonLat2Mercator([a[0],a[1]]),...s.lonLat2Mercator([a[2],a[3]])],h=Math.ceil((o[2]-o[0])/e),d=Math.ceil(this.canvasWidth/e),c=Math.ceil((o[3]-o[1])/i),l=Math.ceil(this.canvasHeight/i);t.globalAlpha=1,t.strokeStyle="rgba(0, 0, 0, 255)";for(let i=1;i<e;++i){const e=s.mercator2LonLat([o[0]+i*h,o[1]]),a=r.formatDegree(e[0])+"E",c=n._createText(t,d*i,0,a,{side:"top",fontSize:Math.ceil(12*this.dpi/96)});this.gridLinePadding.top=c>this.gridLinePadding.top?c:this.gridLinePadding.top;const l=n._createText(t,d*i,this.canvasHeight,a,{side:"bottom",fontSize:Math.ceil(12*this.dpi/96)});this.gridLinePadding.bottom=l>this.gridLinePadding.bottom?l:this.gridLinePadding.bottom}for(let e=1;e<i;++e){const i=s.mercator2LonLat([o[0],o[3]-e*c]),a=r.formatDegree(i[1])+"N",h=n._createText(t,0,l*e,a,{side:"left",fontSize:Math.ceil(12*this.dpi/96)});this.gridLinePadding.left=h>this.gridLinePadding.left?h:this.gridLinePadding.left;const d=n._createText(t,this.canvasWidth,l*e,a,{side:"right",fontSize:Math.ceil(12*this.dpi/96)});this.gridLinePadding.right=d>this.gridLinePadding.right?d:this.gridLinePadding.right}}}},function(t,e,i){"use strict";e.formatDegree=t=>{const e=parseInt(t),i=parseInt(60*Number(t-e).toFixed(12));return e+"°"+i+"′"+parseInt(3600*Number(t-e).toFixed(12)-60*i)+"″"}},function(t,e,i){"use strict";t.exports={_createText(t,e,i,r,{fontSize:n=12,side:s="top"}={}){t.save(),t.fillStyle="#000",t.font=n+"px Arial";let a=e,o=i,h=0;const d=Math.round(t.measureText(r).width);switch(s){case"top":a=e-d/2,o=i+n,h=n;break;case"bottom":a=e-d/2,o=i,h=n;break;case"left":a=e,o=i+n/3,h=d;break;case"right":a=e-d,o=i+n/3,h=d;break;default:return}return t.fillText(r,a,o),t.restore(),h}}},function(t,e,i){"use strict";t.exports={lonLat2Mercator(t){const e=[],i=20037508.342789*t[0]/180;let r=Math.log(Math.tan((90+t[1])*Math.PI/360))/(Math.PI/180);return r=20037508.342789*r/180,e.push(i),e.push(r),e},mercator2LonLat(t){const e=[],i=t[0]/20037508.342789*180;let r=t[1]/20037508.342789*180;return r=180/Math.PI*(2*Math.atan(Math.exp(r*Math.PI/180))-Math.PI/2),e.push(i),e.push(r),e}}},function(t,e,i){"use strict";t.exports=class{constructor(){if("undefined"!=typeof document&&"undefined"!=typeof window)document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?this.document=document:this.document=document.implementation.createHTMLDocument(""),this.window=window;else{const t=new(i(7).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E")).window;this.document=t.document,this.window=t}}}},function(e,i){e.exports=t}])}));